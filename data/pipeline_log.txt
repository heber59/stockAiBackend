--- FULL PIPELINE EXECUTION LOG ---

############################################################
### STEP: Updating Raw Market Data
############################################################
Attempting yfinance fetch for AAPL...
Merging with existing data for AAPL...
Saving 11390 rows to data/raw/AAPL.parquet
Attempting yfinance fetch for MSFT...
Merging with existing data for MSFT...
Saving 10064 rows to data/raw/MSFT.parquet
Attempting yfinance fetch for VRT...
Merging with existing data for VRT...
Saving 1899 rows to data/raw/VRT.parquet
Attempting yfinance fetch for AVGO...
Merging with existing data for AVGO...
Saving 4162 rows to data/raw/AVGO.parquet
Attempting yfinance fetch for SPY...
Saving 8323 rows to data/raw/SPY.parquet
Attempting yfinance fetch for NVDA...
Saving 6813 rows to data/raw/NVDA.parquet
Attempting yfinance fetch for GOOGL...
Saving 5412 rows to data/raw/GOOGL.parquet
Attempting yfinance fetch for AMZN...
Saving 7238 rows to data/raw/AMZN.parquet
Attempting yfinance fetch for META...
Saving 3460 rows to data/raw/META.parquet
Attempting yfinance fetch for TSLA...
Saving 3937 rows to data/raw/TSLA.parquet
Attempting yfinance fetch for AMD...
Saving 11578 rows to data/raw/AMD.parquet
Attempting yfinance fetch for QCOM...
Saving 8608 rows to data/raw/QCOM.parquet
Attempting yfinance fetch for NFLX...
Saving 5976 rows to data/raw/NFLX.parquet

############################################################
### STEP: Generating Advanced Features
############################################################
Starting feature generation for 13 symbols...
Loading SPY as market context...
Processing features for TSLA...
Saving 3904 rows of engineered data to data/features/TSLA.parquet
Processing features for AMZN...
Saving 7205 rows of engineered data to data/features/AMZN.parquet
Processing features for AVGO...
Saving 4129 rows of engineered data to data/features/AVGO.parquet
Processing features for MSFT...
Saving 8293 rows of engineered data to data/features/MSFT.parquet
Processing features for META...
Saving 3427 rows of engineered data to data/features/META.parquet
Processing features for QCOM...
Saving 8293 rows of engineered data to data/features/QCOM.parquet
Processing features for NFLX...
Saving 5943 rows of engineered data to data/features/NFLX.parquet
Processing features for AAPL...
Saving 8293 rows of engineered data to data/features/AAPL.parquet
Processing features for GOOGL...
Saving 5379 rows of engineered data to data/features/GOOGL.parquet
Processing features for NVDA...
Saving 6780 rows of engineered data to data/features/NVDA.parquet
Processing features for VRT...
Saving 1858 rows of engineered data to data/features/VRT.parquet
Processing features for SPY...
Saving 8290 rows of engineered data to data/features/SPY.parquet
Processing features for AMD...
Saving 8292 rows of engineered data to data/features/AMD.parquet

############################################################
### STEP: Auditing Feature Quality
############################################################

==================================================
AUDIT REPORT FOR: data/features/TSLA.parquet
==================================================
Total rows: 3904
Date Range: 2010-08-16 00:00:00-04:00 to 2026-02-23 00:00:00-05:00
Total Null values: 0

--- Feature Quality Checks ---
RSI between 0-100: PASS
RSI Mean: 52.95
ATR mean: 5.04
ADX mean: 25.43
MACD mean: 0.76
Rows below Support_30: 353 (9.0%)
Rows above Resistance_30: 639 (16.4%)

--- Target Distribution (Class Balance) ---
Class 0 (NO MOVE): 54.84%
Class 1 (2% MOVE): 45.16%
Avg Volatility (rolling_vol_30): 0.0339
==================================================


==================================================
AUDIT REPORT FOR: data/features/AMZN.parquet
==================================================
Total rows: 7205
Date Range: 1997-07-02 00:00:00-04:00 to 2026-02-23 00:00:00-05:00
Total Null values: 0

--- Feature Quality Checks ---
RSI between 0-100: PASS
RSI Mean: 53.46
ATR mean: 1.26
ADX mean: 24.94
MACD mean: 0.22
Rows below Support_30: 576 (8.0%)
Rows above Resistance_30: 1224 (17.0%)

--- Target Distribution (Class Balance) ---
Class 0 (NO MOVE): 59.24%
Class 1 (2% MOVE): 40.76%
Avg Volatility (rolling_vol_30): 0.0294
==================================================


############################################################
### STEP: Training Global XGBoost Model
############################################################
Starting GLOBAL training pipeline for symbols: ['AAPL', 'MSFT', 'VRT', 'AVGO', 'SPY', 'NVDA', 'GOOGL', 'AMZN', 'META', 'TSLA', 'AMD', 'QCOM', 'NFLX']
Pooling data from 13 symbols for Global Model...
Global Training Set: 64065 rows. Global Test Set: 16021 rows.
Model training completed.
Evaluating model for GLOBAL_MODEL...

--- Metrics for GLOBAL_MODEL ---
Accuracy:  0.6031
Precision (Buy Signal): 0.4894

Full Classification Report:
              precision    recall  f1-score   support

           0       0.62      0.88      0.73      9711
           1       0.49      0.18      0.26      6310

    accuracy                           0.60     16021
   macro avg       0.56      0.53      0.49     16021
weighted avg       0.57      0.60      0.54     16021


Top 5 Most Important Features:
rolling_vol_30    0.155033
Support_30        0.072017
SPY_volatility    0.046096
Resistance_30     0.045610
MACD_hist         0.044463
dtype: float32
Model and metadata saved to models

Global model successfully trained and saved.

############################################################
### STEP: Backtesting PnL (Buy & Hold 7 days)
############################################################

ðŸš€ STARTING BACKTEST (Threshold: 0.7, Hold: 7 days) ðŸš€
Model loaded from models/xgboost_global_stock_model.json

==================================================
BACKTEST RESULTS - 13 Symbols
==================================================
Total signals triggered:  46
Winning trades:           41 (89.13%)
Average return per trade: 5.64%
Total Cumulative Return:  1016.87%
==================================================

Top 5 Best Trades:
   symbol                      date      prob    return
41    AMD 2020-04-06 00:00:00-04:00  0.753716  0.198443
5    TSLA 2025-04-16 00:00:00-04:00  0.717825  0.183523
40    AMD 2020-04-01 00:00:00-04:00  0.765695  0.166743
26    VRT 2025-04-08 00:00:00-04:00  0.739707  0.163911
22   AAPL 2025-04-08 00:00:00-04:00  0.775223  0.142443

Top 5 Worst Trades:
   symbol                      date      prob    return
4    TSLA 2025-04-09 00:00:00-04:00  0.705216 -0.164218
27    SPY 2020-03-11 00:00:00-04:00  0.717219 -0.161155
28    SPY 2020-03-12 00:00:00-04:00  0.775634 -0.096123
15   QCOM 2022-08-30 00:00:00-04:00  0.722514 -0.012045
44    AMD 2020-05-04 00:00:00-04:00  0.700976 -0.007230

############################################################
### STEP: Generating Latest Predictions
############################################################
Model loaded from models/xgboost_global_stock_model.json

==================================================
PREDICTION FOR: AAPL
==================================================
Latest Market Date: 2026-02-23 00:00:00-05:00
Probability of >2% move (7d): 50.05%
SIGNAL: [HOLD/WAIT]
==================================================


==================================================
PREDICTION FOR: MSFT
==================================================
Latest Market Date: 2026-02-23 00:00:00-05:00
Probability of >2% move (7d): 37.67%
SIGNAL: [HOLD/WAIT]
==================================================


==================================================
PREDICTION FOR: VRT
==================================================
Latest Market Date: 2026-02-23 00:00:00-05:00
Probability of >2% move (7d): 56.77%
SIGNAL: [HOLD/WAIT]
==================================================


==================================================
PREDICTION FOR: AVGO
==================================================
Latest Market Date: 2026-02-23 00:00:00-05:00
Probability of >2% move (7d): 30.20%
SIGNAL: [HOLD/WAIT]
==================================================


==================================================
PREDICTION FOR: SPY
==================================================
Latest Market Date: 2026-02-23 00:00:00-05:00
Probability of >2% move (7d): 24.71%
SIGNAL: [HOLD/WAIT]
==================================================

Results saved to data/latest_predictions.txt
